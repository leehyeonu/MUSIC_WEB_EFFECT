<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Lyric Sync â€“ Santa Tell Me</title>
<style>
  :root{
    --bg:#07070b; --fg:#eef4ff; --neon:#00f5ff; --accent:#6aa8ff;
  }
  html,body{height:100%; background: radial-gradient(60% 80% at 50% 20%, #0f1320 0%, #090b12 55%, #07070b 100%); color:var(--fg); margin:0; font-family: Inter, Pretendard, system-ui, -apple-system, Segoe UI, Roboto;}
  .stage{position:relative; height:100%; overflow:hidden;}
  
  /* Santa (ì´ëª¨ì§€ í¬ê¸° ëŒ€í­ ì¦ê°€) */
  .santa{
    position:absolute; left:8px; bottom:20%;
    font-size: clamp(80px, 16vw, 140px);
    filter: drop-shadow(0 6px 16px rgba(255,0,64,.35)) drop-shadow(0 0 24px rgba(255,0,64,.25));
    animation: bob 2.2s ease-in-out infinite, sway 4.8s ease-in-out infinite;
    transform-origin: 50% 80%;
    line-height: 1;
  }
  @keyframes bob { 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-12px) } }
  @keyframes sway { 0%,100%{ rotate: -5deg } 50%{ rotate: 5deg } }

  /* ê¸€ë˜ìŠ¤ ì¹´ë“œ + ë„¤ì˜¨ ê°€ì‚¬ */
  .glass{
    position:absolute; left:50%; bottom:6%;
    transform: translateX(-50%);
    width:min(95vw, 920px);
    padding:24px 28px;
    border-radius:16px;
    background: rgb(255 255 255 / 7%);
    backdrop-filter: blur(12px) saturate(120%);
    -webkit-backdrop-filter: blur(12px) saturate(120%);
    box-shadow: 0 12px 48px rgba(0,0,0,.45);
    margin-bottom: max(8px, env(safe-area-inset-bottom));
  }
  
  .lyric{
    margin:0;
    font-size: clamp(28px, 7vw, 42px);
    font-weight: 600;
    line-height:1.3;
    letter-spacing:.3px;
    color: #fff;
    text-shadow:
      0 0 8px #fff,
      0 0 20px #fff,
      0 0 36px var(--neon),
      0 0 72px var(--neon);
    min-height: 1.8em;
  }
  
  .gradient{
    background: linear-gradient(90deg, var(--accent), var(--neon) 55%, #86ffd6);
    -webkit-background-clip: text; background-clip:text; color:transparent;
  }
  
  /* ì§„í–‰ ë°” */
  .progress{ height:5px; width:100%; background: rgb(255 255 255 / 18%); border-radius:3px; overflow:hidden; margin-top:14px; }
  .progress > i{ display:block; height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--neon) 60%, #fff); box-shadow: 0 0 12px var(--neon); transition: width .1s linear; }

  /* ìƒë‹¨ ì»¨íŠ¸ë¡¤ */
  .topbar{ 
    position:absolute; top:0; right:0; left:0;
    padding: 12px 16px;
    padding-top: max(12px, env(safe-area-inset-top));
    display:flex; gap:8px; align-items:center;
    background: linear-gradient(180deg, rgba(7,7,11,.8) 0%, rgba(7,7,11,0) 100%);
    z-index: 10;
  }
  
  audio{ 
    width:100%; 
    accent-color: var(--accent);
    height: 32px;
  }

  /* íƒ€ì… ì»¤ì„œ */
  .cursor::after{ 
    content:""; 
    display:inline-block; 
    width: 2px; 
    margin-left: 4px; 
    background: currentColor; 
    height: 1em; 
    animation: blink .7s steps(1) infinite; 
    opacity:.8; 
  }
  @keyframes blink { 50%{ opacity:.2 } }
  
  /* ë¹ˆ ë¼ì¸ ì²˜ë¦¬ */
  .empty { font-size: .5em; }
</style>

<div class="stage">
  <div class="topbar">
    <audio id="player" controls></audio>
  </div>

  <div class="santa" aria-hidden="true">ğŸ…</div>

  <div class="glass">
    <h2 id="lyric" class="lyric gradient cursor">Loadingâ€¦</h2>
    <div class="progress"><i id="bar"></i></div>
  </div>
</div>

<script>
  const AUDIO_FILE = "song.mp3"; // íŒŒì¼ëª… ìˆ˜ì • í•„ìš” ì‹œ ì—¬ê¸°ë§Œ ë³€ê²½
  const audio = document.getElementById('player');
  const lyricEl = document.getElementById('lyric');
  const barEl = document.getElementById('bar');

  /**
   * ê°œì„ ëœ LRC íŒŒì„œ
   * - ë©”íƒ€ë°ì´í„°([ar:], [ti:] ë“±) ìë™ í•„í„°ë§
   * - ì—¬ëŸ¬ íƒ€ì„ìŠ¤íƒí”„ í•œ ì¤„ ëŒ€ì‘
   * - ë¹ˆ í…ìŠ¤íŠ¸ ë¼ì¸ë„ ì²˜ë¦¬
   */
  function parseLRC(text) {
    const tag = /\[(\d{1,2}):(\d{2})(?:\.(\d{1,3}))?\]/g;
    const arr = [];
    
    for (const raw of text.split('\n')) {
      const matches = [...raw.matchAll(tag)];
      if (!matches.length) continue;
      
      // ë§ˆì§€ë§‰ íƒ€ì„ìŠ¤íƒí”„ ë’¤ì˜ í…ìŠ¤íŠ¸ ì¶”ì¶œ
      const textStart = matches[matches.length - 1].index + matches[matches.length - 1][0].length;
      const lineText = raw.slice(textStart).trim();
      
      // ê° íƒ€ì„ìŠ¤íƒí”„ë³„ë¡œ í•­ëª© ìƒì„±
      for (const m of matches) {
        const mm = parseInt(m[1], 10);
        const ss = parseInt(m[2], 10);
        const frac = (m[3] || '0').padEnd(3, '0');
        const ms = (mm * 60 + ss) * 1000 + parseInt(frac, 10);
        arr.push([ms, lineText]);
      }
    }
    
    return arr.sort((a, b) => a[0] - b[0]);
  }

  let timeline = [];
  let idx = 0;
  let lastIdx = -1;

  /**
   * ë¹ ë¥¸ íƒ€ì íš¨ê³¼ (ì‹¤ì œ íƒ€ì´í•‘ ëŠë‚Œ)
   */
  function typeLine(text) {
    if (!text || text.length === 0) {
      lyricEl.textContent = ' ';
      lyricEl.classList.remove('empty');
      return;
    }
    
    if (text.length < 3) {
      lyricEl.classList.add('empty');
    }
    
    lyricEl.textContent = '';
    const chars = [...text];
    let i = 0;
    
    // ë¬¸ì ê¸¸ì´ì— ë”°ë¼ ì†ë„ ì¡°ì • (ìµœì†Œ 20ms, ìµœëŒ€ 60ms)
    const charDelay = Math.max(20, Math.min(60, 1000 / Math.max(10, chars.length)));
    
    const typeInterval = setInterval(() => {
      if (i < chars.length) {
        lyricEl.textContent += chars[i++];
      } else {
        clearInterval(typeInterval);
      }
    }, charDelay);
  }

  /**
   * ë©”ì¸ ë™ê¸°í™” ë£¨í”„
   */
  function tick() {
    requestAnimationFrame(tick);
    
    // íƒ€ì„ë¼ì¸ ë˜ëŠ” ì˜¤ë””ì˜¤ ì •ë³´ ì—†ìœ¼ë©´ ìŠ¤í‚µ
    if (!timeline.length || isNaN(audio.duration)) {
      return;
    }
    
    const pos = audio.currentTime * 1000;
    
    // í˜„ì¬ ìœ„ì¹˜ì— ë§ëŠ” ì¸ë±ìŠ¤ ì°¾ê¸°
    while (idx + 1 < timeline.length && pos >= timeline[idx + 1][0]) {
      idx++;
    }
    
    // ë¼ì¸ì´ ë°”ë€ ê²½ìš°ë§Œ íƒ€ì íš¨ê³¼ ì‹¤í–‰
    if (lastIdx !== idx) {
      lastIdx = idx;
      const [, line] = timeline[idx] || [0, ''];
      typeLine(line);
    }
    
    // ì§„í–‰ ë°” ì—…ë°ì´íŠ¸
    const [t] = timeline[idx] || [0];
    const nextT = idx + 1 < timeline.length ? timeline[idx + 1][0] : (audio.duration * 1000 || t + 1000);
    const pct = Math.max(0, Math.min(1, (pos - t) / Math.max(1, nextT - t)));
    barEl.style.width = (pct * 100) + '%';
  }

  /**
   * ì´ˆê¸°í™” ë° ì‹œì‘
   */
  audio.src = AUDIO_FILE;
  
  // ëª¨ë°”ì¼ì—ì„œ ì‚¬ìš©ì ì œìŠ¤ì²˜ í›„ ì¬ìƒ ì‹œì‘
  document.addEventListener('click', () => {
    if (audio.paused && audio.src) {
      audio.play().catch(err => console.log('ì¬ìƒ ê±°ë¶€ë¨:', err.message));
    }
  }, { once: true });
  
  // LRC ë¡œë“œ
  const embedded = document.getElementById('lrc');
  if (embedded) {
    timeline = parseLRC(embedded.textContent);
    console.log(`âœ“ LRC ë¡œë“œë¨: ${timeline.length}ì¤„`);
  } else {
    console.warn('âš  LRC ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
  
  // ë™ê¸°í™” ì‹œì‘
  tick();
</script>

<!-- ì—¬ê¸°ì— ë³¸ì¸ì˜ LRCë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” -->
<script id="lrc" type="text/plain">
[id: pshzibvw]
[ar: Ariana Grande]
[al: Santa Tell Me - Single]
[ti: Ariana Grande - Santa Tell Me]
[by: ig:@eriksn.egr]

[re: LRC Editor - Android app]
[ve: Version 3.2.6]

[00:00.00]
[00:11.08]Santa, tell me if you're really there
[00:14.83]Don't make me fall in love again
[00:17.56]If he won't be here next year
[00:20.82]Santa, tell me if he really cares
[00:24.84]'Cause I can't give it all away
[00:27.47]If he won't be here next year
[00:31.19]Feeling Christmas all around
[00:33.75]And I'm trying to play it cool
[00:36.29]But it's hard to focus when I see him walkin' 'cross the room
[00:41.41]"Let it Snow" is blasting out
[00:43.66]But I won't get in the mood
[00:46.28]I'm avoiding every mistletoe until I know
[00:50.35]It's true love that he thinks of
[00:54.45]So next Christmas
[00:56.82]I'm not all alone, boy
[01:01.09]Santa, tell me if you're really there
[01:04.97]Don't make me fall in love again
[01:07.52]If he won't be here next year
[01:10.79]Santa, tell me if he really cares
[01:14.91]'Cause I can't give it all away
[01:17.89]If he won't be here next year
[01:21.27]I've been down this road before
[01:23.76]Fell in love on Christmas night (ooh, babe)
[01:26.31]But on New Year's Day, I woke up and he wasn't by my side
[01:31.27]Now I need someone to hold
[01:33.79]Be my fire in the cold (yeah, yeah)
[01:36.36]But it's hard to tell if this is just a fling
[01:39.54]Or if it's true love that he thinks of (of)
[01:44.47]So next Christmas
[01:46.96]I'm not all alone, babe
[01:50.53]Santa, tell me if you're really there
[01:55.10]Don't make me fall in love again
[01:57.50]If he won't be here next year
[02:01.07]Santa, tell me if he really cares
[02:05.04]'Cause I can't give it all away
[02:07.48]If he won't be here next year
[02:12.46]Oh, I wanna have him beside me like oh-oh-oh
[02:17.20]On the 25th by the fire place, oh-oh-oh
[02:21.90]But I don't want a new broken heart
[02:25.56]This year I've got to be smart
[02:29.81]Ooh, baby
[02:30.95](Santa, tell me, Santa, tell me)
[02:34.34]If he will be, if he will be
[02:36.81](Santa, tell me, Santa, tell me)
[02:38.96]Oh-oh-oh
[02:41.22]Santa, tell me if you're really there (Santa, tell me, 'cause I really care)
[02:44.99]Don't make me fall in love again
[02:47.55]If he won't be here next year
[02:50.99]Santa, tell me if he really cares (tell me, tell me, boy)
[02:54.96]'Cause I can't give it all away
[02:57.72]If he won't be here next year
[03:01.27]Santa, tell me if you're really there (tell me, tell me, baby)
[03:05.06]Don't make me fall in love again
[03:07.73]If he won't be here next year (if he won't be, if he won't be here)
[03:11.05]Santa, tell me if he really cares (tell me, do you care?)
[03:14.96]'Cause I can't give it all away
[03:17.46]If he won't be here next year
</script>
