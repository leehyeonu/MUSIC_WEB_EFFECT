<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Lyric Sync ‚Äì Santa Tell Me</title>
<style>
  :root {
    --neon: #00f5ff;
    --accent: #6aa8ff;
    --dark: #07070b;
  }
  * { box-sizing: border-box; }
  html, body {
    height: 100%;
    margin: 0;
    background: radial-gradient(60% 80% at 50% 20%, #0f1320 0%, #090b12 55%, var(--dark) 100%);
    color: #eef4ff;
    font-family: Pretendard, system-ui, -apple-system, sans-serif;
    overflow: hidden;
  }
  
  .stage {
    position: relative;
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* ÏÉÅÎã® Ïò§ÎîîÏò§ Ïª®Ìä∏Î°§ (Ìï≠ÏÉÅ Î≥¥ÏûÑ) */
  .topbar {
    flex-shrink: 0;
    padding: max(12px, env(safe-area-inset-top)) 16px 12px;
    background: linear-gradient(180deg, rgba(7,7,11,.9) 0%, transparent);
    z-index: 20;
  }
  audio {
    width: 100%;
    height: 32px;
    accent-color: var(--accent);
  }

  /* ÏΩòÌÖêÏ∏† ÏòÅÏó≠ */
  .content {
    position: relative;
    flex: 1;
    overflow: hidden;
  }

  /* ÎπÑÏ£ºÏñºÎùºÏù¥Ï†Ä Ï∫îÎ≤ÑÏä§ (Î∞∞Í≤Ω) */
  #vizCanvas {
    position: absolute;
    inset: 0;
    opacity: 0.6;
  }

  /* ÎààÏÜ°Ïù¥ ÌååÌã∞ÌÅ¥ */
  .snowflakes {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }
  .snowflake {
    position: absolute;
    color: #fff;
    font-size: clamp(16px, 3vw, 32px);
    opacity: 0.7;
    animation: fall linear infinite;
  }
  @keyframes fall {
    to { transform: translateY(100vh) rotateZ(360deg); }
  }

  /* ÏÇ∞ÌÉÄ: ÌôîÎ©¥ Ï§ëÏïô ÌïòÎã® */
  .santa-container {
    position: absolute;
    left: 50%;
    bottom: 35%;
    transform: translateX(-50%);
    z-index: 5;
    pointer-events: none;
  }
  .santa {
    font-size: clamp(120px, 25vw, 240px);
    line-height: 1;
    animation: bounce 2.4s ease-in-out infinite, wobble 3.6s ease-in-out infinite, pulse-scale 1.5s ease-in-out infinite;
    filter: drop-shadow(0 10px 28px rgba(255, 0, 64, .5)) drop-shadow(0 0 32px rgba(0, 245, 255, .3));
    text-shadow: 0 0 20px rgba(0, 245, 255, .8);
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-16px); }
  }
  @keyframes wobble {
    0%, 100% { transform: rotateZ(-6deg); }
    50% { transform: rotateZ(6deg); }
  }
  @keyframes pulse-scale {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.08); }
  }

  /* Í∞ÄÏÇ¨ Ïπ¥Îìú: ÏÇ∞ÌÉÄ ÏúÑ */
  .glass {
    position: absolute;
    left: 50%;
    bottom: 55%;
    transform: translateX(-50%);
    max-width: 700px;
    width: calc(100% - 32px);
    padding: 28px 32px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.09);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    box-shadow: 0 16px 64px rgba(0, 0, 0, 0.6), inset 0 1px 1px rgba(255, 255, 255, 0.15);
    z-index: 10;
  }

  .lyric {
    margin: 0;
    font-size: clamp(24px, 6vw, 42px);
    font-weight: 800;
    line-height: 1.4;
    letter-spacing: 0.6px;
    color: #fff;
    text-shadow:
      0 0 12px #fff,
      0 0 28px #fff,
      0 0 44px var(--neon),
      0 0 88px var(--neon);
    min-height: 2.2em;
    word-break: keep-all;
    overflow-wrap: break-word;
  }
  @keyframes lyric-enter {
    0% { opacity: 0; transform: scale(0.95) translateY(10px); }
    100% { opacity: 1; transform: scale(1) translateY(0); }
  }
  .lyric.active { animation: lyric-enter 0.3s ease-out; }

  .gradient {
    background: linear-gradient(135deg, #7aa2ff, var(--neon) 45%, #86ffd6);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    color: transparent;
  }

  .progress {
    height: 7px;
    width: 100%;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 18px;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  .progress > span {
    display: block;
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--accent), var(--neon) 55%, #86ffd6);
    box-shadow: 0 0 20px var(--neon), inset 0 1px 2px rgba(255, 255, 255, 0.3);
    transition: width 0.08s linear;
  }

  .cursor::after {
    content: "";
    display: inline-block;
    width: 3px;
    height: 1em;
    margin-left: 6px;
    background: var(--neon);
    animation: blink 0.8s steps(1) infinite;
    vertical-align: -0.2em;
    box-shadow: 0 0 8px var(--neon);
  }
  @keyframes blink { 50% { opacity: 0.2; } }

  @media (max-width: 480px) {
    .glass { padding: 24px 24px; }
    .lyric { font-size: clamp(20px, 5vw, 36px); }
  }
</style>

<div class="stage">
  <div class="topbar">
    <audio id="player" crossorigin="anonymous"></audio>
  </div>

  <div class="content">
    <!-- ÎπÑÏ£ºÏñºÎùºÏù¥Ï†Ä Ï∫îÎ≤ÑÏä§ -->
    <canvas id="vizCanvas"></canvas>

    <!-- ÎààÏÜ°Ïù¥ ÌååÌã∞ÌÅ¥ -->
    <div class="snowflakes" id="snowflakes"></div>

    <!-- ÏÇ∞ÌÉÄ -->
    <div class="santa-container">
      <div class="santa">üéÖ</div>
    </div>

    <!-- Í∞ÄÏÇ¨ -->
    <div class="glass">
      <h2 id="lyric" class="lyric gradient cursor">Tap play to start‚Ä¶</h2>
      <div class="progress"><span id="bar"></span></div>
    </div>
  </div>
</div>

<script>
const AUDIO_FILE = "song.mp3"; // ‚Üê ÌååÏùºÎ™ÖÎßå ÏàòÏ†ïÌïòÏÑ∏Ïöî
const audio = document.getElementById('player');
const lyricEl = document.getElementById('lyric');
const barEl = document.getElementById('bar');
const canvas = document.getElementById('vizCanvas');
const ctx = canvas.getContext('2d');

// Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ ÏÑ§Ï†ï
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// ====== Web Audio API ÏÑ§Ï†ï ======
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const source = audioCtx.createMediaElementSource(audio);
const analyser = new AnalyserNode(audioCtx, { fftSize: 512, smoothingTimeConstant: 0.8 });
source.connect(analyser).connect(audioCtx.destination);

const freqData = new Uint8Array(analyser.frequencyBinCount);
const timeData = new Uint8Array(analyser.frequencyBinCount);

// ====== ÎπÑÏ£ºÏñºÎùºÏù¥Ï†Ä (Î¶¨Îì¨Î∞òÏùëÌòï Î∞î & Ïõ®Ïù¥Î∏å) ======
function drawVisualizer() {
  analyser.getByteFrequencyData(freqData);
  analyser.getByteTimeDomainData(timeData);

  ctx.fillStyle = 'rgba(7, 7, 11, 0.1)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  const barCount = 64;
  const barWidth = (canvas.width / barCount) * 0.8;
  const barGap = (canvas.width / barCount) * 0.2;
  const centerY = canvas.height * 0.35;

  // Ï£ºÌååÏàò Î∞î (ÏÉÅÎã®)
  for (let i = 0; i < barCount; i++) {
    const idx = Math.floor((i / barCount) * freqData.length);
    const value = freqData[idx] / 255;
    const barHeight = value * (canvas.height * 0.25);
    const x = i * (barWidth + barGap);
    const y = centerY - barHeight;

    const gradient = ctx.createLinearGradient(x, y, x, y + barHeight);
    gradient.addColorStop(0, '#6aa8ff');
    gradient.addColorStop(0.5, '#00f5ff');
    gradient.addColorStop(1, '#86ffd6');

    ctx.fillStyle = gradient;
    ctx.shadowColor = 'rgba(0, 245, 255, 0.6)';
    ctx.shadowBlur = 12;
    ctx.fillRect(x, y, barWidth, barHeight);
  }

  // Ïõ®Ïù¥Î∏å (ÏãúÍ∞ÑÏòÅÏó≠)
  ctx.strokeStyle = '#00f5ff';
  ctx.lineWidth = 2;
  ctx.shadowColor = 'rgba(0, 245, 255, 0.8)';
  ctx.shadowBlur = 16;
  ctx.beginPath();
  for (let i = 0; i < timeData.length; i++) {
    const value = (timeData[i] / 128) - 1;
    const x = (i / timeData.length) * canvas.width;
    const y = canvas.height * 0.7 + value * 80;
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.stroke();
  ctx.shadowBlur = 0;

  requestAnimationFrame(drawVisualizer);
}
drawVisualizer();

// ====== ÎààÏÜ°Ïù¥ ÌååÌã∞ÌÅ¥ ======
function createSnowflake() {
  const snowflakes = document.getElementById('snowflakes');
  const flake = document.createElement('div');
  flake.className = 'snowflake';
  flake.textContent = '‚ùÑ';
  
  const x = Math.random() * window.innerWidth;
  const y = -50;
  const duration = 8 + Math.random() * 4;
  const delay = Math.random() * 2;

  flake.style.left = x + 'px';
  flake.style.top = y + 'px';
  flake.style.animationDuration = duration + 's';
  flake.style.animationDelay = delay + 's';
  flake.style.opacity = (0.3 + Math.random() * 0.5);

  snowflakes.appendChild(flake);
  setTimeout(() => flake.remove(), (duration + delay) * 1000);
}
setInterval(createSnowflake, 300);

// ====== LRC ÌååÏã± ======
function parseLRC(text) {
  const tag = /\[(\d{1,2}):(\d{2})(?:\.(\d{1,3}))?\]/g;
  const lines = [];
  for (const raw of text.split(/\r?\n/)) {
    const matches = [...raw.matchAll(tag)];
    if (!matches.length) continue;
    const lyric = raw.slice(matches[matches.length - 1].index + matches[matches.length - 1][0].length).trim();
    for (const m of matches) {
      const mm = +m[1], ss = +m[2], frac = (m[3] || '0').padEnd(3, '0');
      lines.push([(mm * 60 + ss) * 1000 + +frac, lyric]);
    }
  }
  return lines.sort((a, b) => a[0] - b[0]);
}

const lrcNode = document.getElementById('lrc');
const timeline = lrcNode ? parseLRC(lrcNode.textContent) : [];

let idx = 0, lastIdx = -1, canSync = false;

audio.src = AUDIO_FILE;
audio.addEventListener('loadedmetadata', () => { canSync = true; });
window.addEventListener('click', () => {
  if (audio.paused && audio.src) audio.play().catch(() => {});
}, { once: true });

// ====== ÌÉÄÏù¥Ìïë Ìö®Í≥º ======
let typeTimer = null;
function typeLine(text) {
  if (typeTimer) clearInterval(typeTimer);
  lyricEl.textContent = '';
  lyricEl.classList.add('active');
  
  const chars = [...(text || ' ')];
  let i = 0;
  const delay = Math.max(16, Math.min(50, 1000 / Math.max(12, chars.length)));
  
  typeTimer = setInterval(() => {
    if (i < chars.length) {
      lyricEl.textContent += chars[i++];
    } else {
      clearInterval(typeTimer);
      lyricEl.classList.remove('active');
    }
  }, delay);
}

// ====== ÎèôÍ∏∞Ìôî Î£®ÌîÑ ======
function tick() {
  requestAnimationFrame(tick);
  
  if (!canSync || !timeline.length || isNaN(audio.duration) || audio.paused) {
    return;
  }

  const pos = audio.currentTime * 1000;
  
  while (idx + 1 < timeline.length && pos >= timeline[idx + 1][0]) {
    idx++;
  }

  if (lastIdx !== idx) {
    lastIdx = idx;
    typeLine(timeline[idx][1]);
  }

  const [t] = timeline[idx] || [0];
  const nextT = (idx + 1 < timeline.length) ? timeline[idx + 1][0] : (audio.duration * 1000);
  const pct = Math.max(0, Math.min(1, (pos - t) / Math.max(1, nextT - t)));
  barEl.style.width = (pct * 100).toFixed(1) + '%';
}
tick();

// Î™®Î∞îÏùº Ïò§ÎîîÏò§ Ï†ïÏ±Ö ÎåÄÏùë
audioCtx.resume().catch(() => {});
</script>


<!-- Ïó¨Í∏∞Ïóê Î≥∏Ïù∏Ïùò LRCÎ•º Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî -->
<script id="lrc" type="text/plain">
[id: pshzibvw]
[ar: Ariana Grande]
[al: Santa Tell Me - Single]
[ti: Ariana Grande - Santa Tell Me]
[by: ig:@eriksn.egr]

[re: LRC Editor - Android app]
[ve: Version 3.2.6]

[00:00.00]
[00:10.08]Santa, tell me if you're really there
[00:13.83]Don't make me fall in love again
[00:16.56]If he won't be here next year
[00:19.82]Santa, tell me if he really cares
[00:23.84]'Cause I can't give it all away
[00:26.47]If he won't be here next year
[00:30.19]Feeling Christmas all around
[00:32.75]And I'm trying to play it cool
[00:35.29]But it's hard to focus when I see him walkin' 'cross the room
[00:40.41]"Let it Snow" is blasting out
[00:42.66]But I won't get in the mood
[00:45.28]I'm avoiding every mistletoe until I know
[00:49.35]It's true love that he thinks of
[00:53.45]So next Christmas
[00:55.82]I'm not all alone, boy
[01:00.09]Santa, tell me if you're really there
[01:03.97]Don't make me fall in love again
[01:06.52]If he won't be here next year
[01:09.79]Santa, tell me if he really cares
[01:13.91]'Cause I can't give it all away
[01:16.89]If he won't be here next year
[01:20.27]I've been down this road before
[01:23.76]Fell in love on Christmas night (ooh, babe)
[01:26.31]But on New Year's Day, I woke up and he wasn't by my side
[01:31.27]Now I need someone to hold
[01:33.79]Be my fire in the cold (yeah, yeah)
[01:36.36]But it's hard to tell if this is just a fling
[01:39.54]Or if it's true love that he thinks of (of)
[01:44.47]So next Christmas
[01:46.96]I'm not all alone, babe
[01:50.53]Santa, tell me if you're really there
[01:55.10]Don't make me fall in love again
[01:57.50]If he won't be here next year
[02:01.07]Santa, tell me if he really cares
[02:05.04]'Cause I can't give it all away
[02:07.48]If he won't be here next year
[02:12.46]Oh, I wanna have him beside me like oh-oh-oh
[02:17.20]On the 25th by the fire place, oh-oh-oh
[02:21.90]But I don't want a new broken heart
[02:25.56]This year I've got to be smart
[02:29.81]Ooh, baby
[02:30.95](Santa, tell me, Santa, tell me)
[02:34.34]If he will be, if he will be
[02:36.81](Santa, tell me, Santa, tell me)
[02:38.96]Oh-oh-oh
[02:41.22]Santa, tell me if you're really there (Santa, tell me, 'cause I really care)
[02:44.99]Don't make me fall in love again
[02:47.55]If he won't be here next year
[02:50.99]Santa, tell me if he really cares (tell me, tell me, boy)
[02:54.96]'Cause I can't give it all away
[02:57.72]If he won't be here next year
[03:01.27]Santa, tell me if you're really there (tell me, tell me, baby)
[03:05.06]Don't make me fall in love again
[03:07.73]If he won't be here next year (if he won't be, if he won't be here)
[03:11.05]Santa, tell me if he really cares (tell me, do you care?)
[03:14.96]'Cause I can't give it all away
[03:17.46]If he won't be here next year
</script>
